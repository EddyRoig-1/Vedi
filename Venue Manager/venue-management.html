<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venue Management - Venue Admin Dashboard</title>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
    <script src="../firebase-config.js"></script>
    <script src="../firebase-api.js"></script>
    <script src="restaurant-venue-sync.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: #1a202c;
        }

        .header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .back-btn {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 12px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .management-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .venue-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .metric-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .metric-change.positive {
            color: #38a169;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .quick-action-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .quick-action-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .quick-action-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .quick-action-description {
            font-size: 0.9rem;
            color: #718096;
            line-height: 1.5;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-pending {
            background: #faf089;
            color: #744210;
        }

        .status-inactive {
            background: #feb2b2;
            color: #742a2a;
        }

        .status-approved {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-denied {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-cancelled {
            background: #e2e8f0;
            color: #4a5568;
        }

        .status-accepted {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-declined {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-expired {
            background: #faf089;
            color: #744210;
        }

        .card-item {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .card-item:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .card-info {
            flex: 1;
        }

        .card-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .card-date {
            font-size: 0.85rem;
            color: #667eea;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .card-message {
            background: #edf2f7;
            border-left: 4px solid #667eea;
            padding: 12px 16px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #4a5568;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .activity-timeline {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            padding: 15px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .activity-icon.invitation {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .activity-icon.request {
            background: rgba(251, 176, 64, 0.1);
            color: #fbb040;
        }

        .activity-icon.restaurant {
            background: rgba(72, 187, 120, 0.1);
            color: #48bb78;
        }

        .activity-icon.performance {
            background: rgba(251, 176, 64, 0.1);
            color: #fbb040;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .activity-description {
            font-size: 0.9rem;
            color: #718096;
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #a0aec0;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Integrated Invitation Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            0% { transform: translateY(50px) scale(0.95); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .modal-subtitle {
            color: #718096;
            font-size: 1rem;
            line-height: 1.5;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            outline: none;
            background: white;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.5;
        }

        .invitation-preview {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
        }

        .invitation-preview-title {
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .invitation-link {
            background: white;
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 15px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #0369a1;
            margin-bottom: 15px;
        }

        .copy-link-btn {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .copy-link-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.3);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .tabs-container {
            margin-bottom: 30px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            color: #718096;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .venue-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .modal-content {
                padding: 20px;
                margin: 10px;
            }

            .modal-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .card-header {
                flex-direction: column;
                gap: 10px;
            }

            .card-actions {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-card">
            <div class="loading-spinner"></div>
            <p id="loadingText">Loading venue management...</p>
        </div>
    </div>

    <div class="header">
        <div class="header-content">
            <h1>🏢 <span id="venueName">Venue Management</span></h1>
            <a href="venue-admin-dashboard.html" class="back-btn">← Back to Main</a>
        </div>
    </div>

    <div class="container">
        <!-- Venue Overview Stats -->
        <div class="management-section">
            <div class="section-header">
                <h3 class="section-title">Venue Overview</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshVenueData()">🔄 Refresh</button>
                    <button class="btn btn-secondary" onclick="exportVenueReport()">📄 Export Report</button>
                </div>
            </div>

            <div class="venue-stats-grid">
                <div class="metric-card">
                    <div class="metric-icon">🏪</div>
                    <div class="metric-value" id="totalRestaurants">0</div>
                    <div class="metric-label">Total Restaurants</div>
                    <div class="metric-change positive">Active in venue</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">📨</div>
                    <div class="metric-value" id="pendingInvites">0</div>
                    <div class="metric-label">Pending Invitations</div>
                    <div class="metric-change">Awaiting response</div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon">📋</div>
                    <div class="metric-value" id="pendingRequests">0</div>
                    <div class="metric-label">Pending Requests</div>
                    <div class="metric-change">Awaiting approval</div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon">📊</div>
                    <div class="metric-value" id="venueOccupancy">0%</div>
                    <div class="metric-label">Venue Occupancy</div>
                    <div class="metric-change positive">Space utilization</div>
                </div>
            </div>
        </div>

        <!-- Quick Management Actions -->
        <div class="management-section">
            <div class="section-header">
                <h3 class="section-title">Quick Actions</h3>
            </div>

            <div class="quick-actions">
                <div class="quick-action-card" onclick="openInvitationCenter()">
                    <div class="quick-action-icon">📨</div>
                    <div class="quick-action-title">Send Invitations</div>
                    <div class="quick-action-description">Invite new restaurants to join your venue</div>
                </div>

                <div class="quick-action-card" onclick="openRestaurantDirectory()">
                    <div class="quick-action-icon">📋</div>
                    <div class="quick-action-title">Restaurant Directory</div>
                    <div class="quick-action-description">View and manage all restaurants</div>
                </div>

                <div class="quick-action-card" onclick="openRequestsManagement()">
                    <div class="quick-action-icon">📝</div>
                    <div class="quick-action-title">Join Requests</div>
                    <div class="quick-action-description">Review restaurant join requests</div>
                </div>

                <div class="quick-action-card" onclick="openVenueAnalytics()">
                    <div class="quick-action-icon">📊</div>
                    <div class="quick-action-title">Venue Analytics</div>
                    <div class="quick-action-description">Comprehensive venue performance metrics</div>
                </div>
            </div>
        </div>

        <!-- Restaurant Directory -->
        <div class="management-section">
            <div class="section-header">
                <h3 class="section-title">Restaurant Directory</h3>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="openInvitationCenter()">📨 Invite Restaurant</button>
                    <button class="btn btn-secondary" onclick="refreshRestaurants()">🔄 Refresh</button>
                </div>
            </div>

            <table class="data-table" id="restaurantDirectoryTable">
                <thead>
                    <tr>
                        <th>Restaurant</th>
                        <th>Contact</th>
                        <th>Status</th>
                        <th>Join Date</th>
                        <th>Join Method</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="restaurantDirectoryTableBody">
                    <!-- Will be populated dynamically -->
                </tbody>
            </table>
        </div>

        <!-- Requests & Invitations Management -->
        <div class="management-section">
            <div class="section-header">
                <h3 class="section-title">Requests & Invitations Management</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openInvitationCenter()">📨 Send New Invitation</button>
                </div>
            </div>

            <div class="tabs-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTab('requests')">
                        📋 Restaurant Requests (<span id="requestsCount">0</span>)
                    </button>
                    <button class="tab-button" onclick="switchTab('invitations')">
                        📨 Sent Invitations (<span id="invitationsCount">0</span>)
                    </button>
                </div>

                <!-- Restaurant Requests Tab -->
                <div id="requestsTab" class="tab-content active">
                    <div id="restaurantRequestsContainer">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <!-- Invitations Tab -->
                <div id="invitationsTab" class="tab-content">
                    <div id="venueInvitationsContainer">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="management-section">
            <div class="section-header">
                <h3 class="section-title">Recent Venue Activity</h3>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="viewFullActivityLog()">📋 View Full Log</button>
                </div>
            </div>

            <div class="activity-timeline" id="activityTimeline">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Integrated Invitation Modal -->
    <div class="modal" id="invitationModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeInvitationModal()">&times;</button>
            
            <div class="modal-header">
                <div class="modal-icon">📨</div>
                <h2 class="modal-title">Invite Restaurant to Join Venue</h2>
                <p class="modal-subtitle">Send an invitation to a restaurant owner to join your food hall venue.</p>
            </div>

            <form id="invitationForm">
                <div class="form-section">
                    <div class="form-section-title">
                        <span>🏢</span>
                        Venue Information
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Venue Name</label>
                            <input type="text" class="form-input" id="venueNameInput" placeholder="Downtown Food Hall" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Venue Address</label>
                            <input type="text" class="form-input" id="venueAddress" placeholder="123 Main Street, City" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Venue Description</label>
                        <textarea class="form-textarea" id="venueDescription" placeholder="Describe your food hall venue, amenities, and what makes it special..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">
                        <span>🏪</span>
                        Restaurant Information
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Restaurant Name</label>
                            <input type="text" class="form-input" id="restaurantName" placeholder="Bella Vista Restaurant" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Contact Email</label>
                            <input type="email" class="form-input" id="contactEmail" placeholder="owner@restaurant.com" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Personal Message (Optional)</label>
                        <textarea class="form-textarea" id="personalMessage" placeholder="Add a personal note to the restaurant owner..."></textarea>
                    </div>
                </div>

                <div class="invitation-preview" id="invitationPreview" style="display: none;">
                    <div class="invitation-preview-title">
                        <span>🔗</span>
                        Invitation Link Generated
                    </div>
                    <p style="color: #0369a1; margin-bottom: 15px;">Share this link with the restaurant owner:</p>
                    <div class="invitation-link" id="generatedLink"></div>
                    <button type="button" class="copy-link-btn" onclick="copyInvitationLink()">
                        <span>📋</span>
                        Copy Link
                    </button>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeInvitationModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="generateInvitation()">
                        <span>📨</span>
                        Generate Invitation
                    </button>
                    <button type="button" class="btn btn-success" id="sendInvitationBtn" onclick="sendInvitation()" style="display: none;">
                        <span>✉️</span>
                        Send Invitation
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentVenue = null;
        let venueRestaurants = [];
        let venueRequests = [];
        let venueInvitations = [];
        let venueActivity = [];
        let generatedInvitationData = null;
        let currentTab = 'requests';

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🏢 Enhanced Venue Management with VenueSync initializing...');
            
            try {
                await initializeVenueManagement();
            } catch (error) {
                console.error('❌ Error initializing venue management:', error);
                showError('Failed to load venue management: ' + error.message);
                hideLoading();
            }
        });

        // Authentication and initialization
        async function initializeVenueManagement() {
            showLoading('Checking authentication...');
            
            try {
                // Check authentication
                currentUser = await VediAPI.getCurrentUser();
                if (!currentUser) {
                    console.log('No authenticated user, redirecting to login');
                    window.location.href = '../Landing-Signup-Login/login.html';
                    return;
                }

                console.log('✅ Authenticated user:', currentUser.email);

                // Check if user is venue manager
                if (currentUser.accountType !== 'venue') {
                    showError('Access denied. This page is for venue managers only.');
                    setTimeout(() => {
                        window.location.href = '../Owner/dashboard.html';
                    }, 2000);
                    return;
                }

                showLoading('Loading venue data...');

                // Load venue data
                currentVenue = await VediAPI.getVenueByManager(currentUser.id);
                if (!currentVenue) {
                    console.log('No venue found, redirecting to setup');
                    window.location.href = '../Landing-Signup-Login/venue-setup.html';
                    return;
                }

                console.log('✅ Loaded venue:', currentVenue.name);
                document.getElementById('venueName').textContent = currentVenue.name;

                // Pre-fill venue information in modal
                document.getElementById('venueNameInput').value = currentVenue.name;
                document.getElementById('venueAddress').value = currentVenue.address || '';
                document.getElementById('venueDescription').value = currentVenue.description || '';

                showLoading('Loading restaurants and requests...');

                // Load all venue data using VenueSync
                await loadAllVenueData();
                
                // Update UI
                updateVenueManagement();
                
                hideLoading();
                showSuccess('Venue management loaded successfully!');
                
            } catch (error) {
                console.error('❌ Venue management initialization error:', error);
                showError('Failed to load venue management: ' + error.message);
                hideLoading();
            }
        }

        // Data loading functions using VenueSync
        async function loadAllVenueData() {
            try {
                // Load venues restaurants
                venueRestaurants = await VenueSync.getVenueRestaurants(currentVenue.id);
                console.log('✅ Loaded venue restaurants:', venueRestaurants.length);

                // Load restaurant requests
                venueRequests = await VenueSync.getVenueRequests(currentVenue.id);
                console.log('✅ Loaded venue requests:', venueRequests.length);

                // Load venue invitations
                venueInvitations = await VenueSync.getVenueInvitations(currentVenue.id);
                console.log('✅ Loaded venue invitations:', venueInvitations.length);

                // Load activity
                await loadVenueActivity();
                
            } catch (error) {
                console.error('❌ Error loading venue data:', error);
                // Initialize empty arrays for graceful degradation
                venueRestaurants = [];
                venueRequests = [];
                venueInvitations = [];
                venueActivity = [];
            }
        }

        async function loadVenueActivity() {
            try {
                // Query activity for this venue from Firestore
                const db = getFirebaseDb();
                const querySnapshot = await db.collection('venueActivity')
                    .where('venueId', '==', currentVenue.id)
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();

                venueActivity = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                console.log('✅ Loaded venue activity:', venueActivity.length);
            } catch (error) {
                console.error('❌ Error loading venue activity:', error);
                venueActivity = [];
            }
        }

        function updateVenueManagement() {
            updateVenueStats();
            updateRestaurantDirectory();
            updateRequestsAndInvitations();
            updateActivityTimeline();
        }

        function updateVenueStats() {
            const restaurantCount = venueRestaurants.length;
            const pendingInvitesCount = venueInvitations.filter(inv => inv.status === 'pending').length;
            const pendingRequestsCount = venueRequests.filter(req => req.status === 'pending').length;
            
            // Calculate occupancy (assuming max capacity based on venue size)
            const maxCapacity = currentVenue.maxRestaurants || 20;
            const occupancyRate = Math.round((restaurantCount / maxCapacity) * 100);

            document.getElementById('totalRestaurants').textContent = restaurantCount;
            document.getElementById('pendingInvites').textContent = pendingInvitesCount;
            document.getElementById('pendingRequests').textContent = pendingRequestsCount;
            document.getElementById('venueOccupancy').textContent = `${occupancyRate}%`;

            // Update tab counts
            document.getElementById('requestsCount').textContent = venueRequests.length;
            document.getElementById('invitationsCount').textContent = venueInvitations.length;
        }

        function updateRestaurantDirectory() {
            const tbody = document.getElementById('restaurantDirectoryTableBody');
            
            if (venueRestaurants.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #718096;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">🏪</div>
                            <div>No restaurants connected</div>
                            <div style="font-size: 0.9rem; margin-top: 5px;">Send invitations to restaurant owners to join your venue</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = venueRestaurants.map(restaurant => {
                const joinDate = restaurant.joinedVenueAt ? 
                    VediAPI.timestampToDate(restaurant.joinedVenueAt).toLocaleDateString() : 
                    VediAPI.timestampToDate(restaurant.createdAt).toLocaleDateString();
                
                const joinMethod = getSyncMethodText(restaurant.syncMethod);
                const currency = restaurant.currency || { symbol: '$' };

                return `
                    <tr>
                        <td>
                            <div style="font-weight: 600;">${restaurant.name}</div>
                            <div style="font-size: 0.85rem; color: #718096;">${restaurant.address || 'Address not set'}</div>
                            <div style="font-size: 0.8rem; color: #667eea; text-transform: uppercase;">${restaurant.cuisineType || 'Restaurant'}</div>
                        </td>
                        <td>
                            <div style="font-size: 0.9rem;">${restaurant.phone || 'N/A'}</div>
                            <div style="font-size: 0.85rem; color: #718096;">${restaurant.email || 'No email'}</div>
                        </td>
                        <td><span class="status-badge status-active">Active</span></td>
                        <td>${joinDate}</td>
                        <td>
                            <span class="status-badge ${getSyncMethodClass(restaurant.syncMethod)}">${joinMethod}</span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                <button class="btn-small btn-secondary" onclick="viewRestaurantDetails('${restaurant.id}')">View</button>
                                <button class="btn-small btn-secondary" onclick="contactRestaurant('${restaurant.id}')">Contact</button>
                                <button class="btn-small btn-danger" onclick="removeRestaurant('${restaurant.id}')">Remove</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateRequestsAndInvitations() {
            updateRestaurantRequests();
            updateVenueInvitations();
        }

        function updateRestaurantRequests() {
            const container = document.getElementById('restaurantRequestsContainer');
            const pendingRequests = venueRequests.filter(req => req.status === 'pending');
            const allRequests = venueRequests;
            
            if (allRequests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📝</div>
                        <div>No restaurant requests</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">Restaurant owners can request to join your venue from their settings</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = allRequests.map(request => {
                const isPending = request.status === 'pending';
                const statusClass = `status-${request.status}`;
                
                return `
                    <div class="card-item">
                        <div class="card-header">
                            <div class="card-info">
                                <div class="card-title">${request.restaurantName}</div>
                                <div class="card-subtitle">${request.restaurantEmail}</div>
                                <div class="card-subtitle">${request.restaurantCuisine} • ${request.restaurantAddress}</div>
                                <div class="card-date">Requested: ${VediAPI.timestampToDate(request.requestedAt).toLocaleDateString()}</div>
                            </div>
                            <div>
                                <span class="status-badge ${statusClass}">${request.status.toUpperCase()}</span>
                            </div>
                        </div>
                        ${request.message ? `<div class="card-message">"${request.message}"</div>` : ''}
                        <div class="card-actions">
                            ${isPending ? `
                                <button class="btn-small btn-success" onclick="approveRestaurantRequest('${request.id}')">
                                    ✅ Approve
                                </button>
                                <button class="btn-small btn-danger" onclick="denyRestaurantRequest('${request.id}')">
                                    ❌ Deny
                                </button>
                            ` : ''}
                            <button class="btn-small btn-secondary" onclick="viewRequestDetails('${request.id}')">
                                👁️ Details
                            </button>
                            ${request.status === 'denied' && request.denialReason ? `
                                <div style="font-size: 0.8rem; color: #991b1b; margin-top: 8px;">
                                    <strong>Denial reason:</strong> ${request.denialReason}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateVenueInvitations() {
            const container = document.getElementById('venueInvitationsContainer');
            
            if (venueInvitations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📨</div>
                        <div>No invitations sent</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">Send invitations to restaurant owners to join your venue</div>
                        <button class="btn btn-primary" onclick="openInvitationCenter()" style="margin-top: 15px;">
                            📨 Send First Invitation
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = venueInvitations.map(invite => {
                const isPending = invite.status === 'pending';
                const statusClass = `status-${invite.status}`;
                const isExpired = invite.expiresAt && new Date() > invite.expiresAt.toDate();
                
                return `
                    <div class="card-item">
                        <div class="card-header">
                            <div class="card-info">
                                <div class="card-title">${invite.restaurantName}</div>
                                <div class="card-subtitle">${invite.contactEmail}</div>
                                <div class="card-date">Sent: ${VediAPI.timestampToDate(invite.createdAt).toLocaleDateString()}</div>
                                ${invite.expiresAt ? `
                                    <div class="card-date">Expires: ${invite.expiresAt.toDate().toLocaleDateString()}</div>
                                ` : ''}
                                ${isExpired && isPending ? `
                                    <div style="color: #ef4444; font-size: 0.8rem; font-weight: 600;">⚠️ EXPIRED</div>
                                ` : ''}
                            </div>
                            <div>
                                <span class="status-badge ${statusClass}">${invite.status.toUpperCase()}</span>
                            </div>
                        </div>
                        ${invite.personalMessage ? `<div class="card-message">"${invite.personalMessage}"</div>` : ''}
                        <div class="card-actions">
                            ${isPending && !isExpired ? `
                                <button class="btn-small btn-secondary" onclick="resendInvitation('${invite.id}')">🔄 Resend</button>
                                <button class="btn-small btn-danger" onclick="cancelInvitation('${invite.id}')">❌ Cancel</button>
                            ` : ''}
                            ${isExpired && isPending ? `
                                <button class="btn-small btn-primary" onclick="renewInvitation('${invite.id}')">🔄 Renew</button>
                            ` : ''}
                            <button class="btn-small btn-secondary" onclick="viewInvitationDetails('${invite.id}')">👁️ Details</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateActivityTimeline() {
            const timeline = document.getElementById('activityTimeline');
            
            if (venueActivity.length === 0) {
                timeline.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📋</div>
                        <div>No recent activity</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">Venue activities will appear here</div>
                    </div>
                `;
                return;
            }

            timeline.innerHTML = venueActivity
                .slice(0, 10)
                .map(activity => {
                    const activityDate = VediAPI.timestampToDate(activity.timestamp);
                    const timeAgo = getTimeAgo(activityDate);
                    
                    return `
                        <div class="activity-item">
                            <div class="activity-icon ${activity.type}">
                                ${getActivityIcon(activity.type)}
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-description">${activity.description}</div>
                                <div class="activity-time">${timeAgo}</div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        // Request Management Functions
        async function approveRestaurantRequest(requestId) {
            if (!confirm('Are you sure you want to approve this restaurant request? The restaurant will be added to your venue.')) {
                return;
            }

            try {
                showLoading('Approving request...', 'Adding restaurant to venue');

                await VenueSync.approveRestaurantRequest(requestId);
                
                // Refresh data
                await loadAllVenueData();
                updateVenueManagement();
                
                hideLoading();
                showSuccess('Restaurant request approved successfully! The restaurant has been added to your venue.');
                
            } catch (error) {
                console.error('❌ Error approving request:', error);
                hideLoading();
                showError('Failed to approve request: ' + error.message);
            }
        }

        async function denyRestaurantRequest(requestId) {
            const reason = prompt('Please provide a reason for denying this request (optional):');
            if (reason === null) return; // User cancelled

            try {
                showLoading('Denying request...', 'Updating request status');

                await VenueSync.denyRestaurantRequest(requestId, reason || '');
                
                // Refresh data
                await loadAllVenueData();
                updateVenueManagement();
                
                hideLoading();
                showSuccess('Restaurant request denied successfully.');
                
            } catch (error) {
                console.error('❌ Error denying request:', error);
                hideLoading();
                showError('Failed to deny request: ' + error.message);
            }
        }

        // Invitation system functions
        function openInvitationCenter() {
            console.log('📨 Opening invitation center...');
            document.getElementById('invitationModal').classList.add('show');
            resetInvitationForm();
        }

        function closeInvitationModal() {
            document.getElementById('invitationModal').classList.remove('show');
            resetInvitationForm();
        }

        function resetInvitationForm() {
            document.getElementById('invitationForm').reset();
            
            // Re-populate venue information
            document.getElementById('venueNameInput').value = currentVenue.name;
            document.getElementById('venueAddress').value = currentVenue.address || '';
            document.getElementById('venueDescription').value = currentVenue.description || '';
            
            document.getElementById('invitationPreview').style.display = 'none';
            document.getElementById('sendInvitationBtn').style.display = 'none';
            generatedInvitationData = null;
        }

        async function generateInvitation() {
            const venueName = document.getElementById('venueNameInput').value.trim();
            const venueAddress = document.getElementById('venueAddress').value.trim();
            const venueDescription = document.getElementById('venueDescription').value.trim();
            const restaurantName = document.getElementById('restaurantName').value.trim();
            const contactEmail = document.getElementById('contactEmail').value.trim();
            const personalMessage = document.getElementById('personalMessage').value.trim();

            if (!venueName || !venueAddress || !restaurantName || !contactEmail) {
                showError('Please fill in all required fields.');
                return;
            }

            try {
                showLoading('Generating invitation...', 'Creating invitation link');

                // Use VenueSync to create invitation
                const restaurantData = {
                    restaurantName: restaurantName,
                    contactEmail: contactEmail
                };

                const invitation = await VenueSync.createVenueInvitation(currentVenue.id, restaurantData, personalMessage);
                
                generatedInvitationData = invitation;
                
                // Show preview
                document.getElementById('generatedLink').textContent = invitation.invitationLink;
                document.getElementById('invitationPreview').style.display = 'block';
                document.getElementById('sendInvitationBtn').style.display = 'inline-flex';

                console.log('✅ Generated invitation:', generatedInvitationData);
                
                hideLoading();
                showSuccess('Invitation generated successfully!');
                
            } catch (error) {
                console.error('❌ Error generating invitation:', error);
                hideLoading();
                showError('Failed to generate invitation: ' + error.message);
            }
        }

        function copyInvitationLink() {
            const linkText = document.getElementById('generatedLink').textContent;
            navigator.clipboard.writeText(linkText).then(() => {
                showSuccess('Invitation link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = linkText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showSuccess('Invitation link copied to clipboard!');
            });
        }

        function sendInvitation() {
            if (!generatedInvitationData) {
                showError('Please generate an invitation first.');
                return;
            }

            // Refresh data and close modal
            loadAllVenueData().then(() => {
                updateVenueManagement();
                closeInvitationModal();
                showSuccess(`Invitation created for ${generatedInvitationData.restaurantName}! Share the link with them.`);
            });
        }

        // Tab Management
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // Management action functions
        async function refreshVenueData() {
            console.log('🔄 Refreshing venue data...');
            try {
                showLoading('Refreshing data...', 'Loading latest information');
                await loadAllVenueData();
                updateVenueManagement();
                hideLoading();
                showSuccess('Venue data refreshed successfully');
            } catch (error) {
                console.error('Error refreshing venue data:', error);
                showError('Failed to refresh data: ' + error.message);
                hideLoading();
            }
        }

        async function refreshRestaurants() {
            try {
                showLoading('Refreshing restaurants...', 'Loading restaurant data');
                venueRestaurants = await VenueSync.getVenueRestaurants(currentVenue.id);
                updateRestaurantDirectory();
                updateVenueStats();
                hideLoading();
                showSuccess('Restaurant directory refreshed');
            } catch (error) {
                console.error('Error refreshing restaurants:', error);
                showError('Failed to refresh restaurants: ' + error.message);
                hideLoading();
            }
        }

        async function exportVenueReport() {
            console.log('📄 Exporting venue report...');
            
            try {
                showLoading('Generating report...', 'Compiling venue data');
                
                const reportData = {
                    generatedAt: new Date().toISOString(),
                    venue: currentVenue,
                    stats: {
                        totalRestaurants: venueRestaurants.length,
                        pendingInvitations: venueInvitations.filter(inv => inv.status === 'pending').length,
                        pendingRequests: venueRequests.filter(req => req.status === 'pending').length,
                        occupancyRate: Math.round((venueRestaurants.length / (currentVenue.maxRestaurants || 20)) * 100)
                    },
                    restaurants: venueRestaurants,
                    requests: venueRequests,
                    invitations: venueInvitations,
                    recentActivity: venueActivity.slice(0, 20)
                };

                const dataStr = JSON.stringify(reportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `venue-report-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                hideLoading();
                showSuccess('Venue report exported successfully');
                
            } catch (error) {
                console.error('Error exporting venue report:', error);
                showError('Failed to export report: ' + error.message);
                hideLoading();
            }
        }

        // Quick action functions
        function openRestaurantDirectory() {
            console.log('📋 Opening restaurant directory...');
            document.getElementById('restaurantDirectoryTable').scrollIntoView({ behavior: 'smooth' });
        }

        function openRequestsManagement() {
            console.log('📝 Opening requests management...');
            switchTab('requests');
            document.querySelector('.tabs-container').scrollIntoView({ behavior: 'smooth' });
        }

        function openVenueAnalytics() {
            console.log('📊 Opening venue analytics...');
            showSuccess('Opening comprehensive analytics...');
        }

        // Restaurant management functions
        function viewRestaurantDetails(restaurantId) {
            console.log('👁️ Viewing restaurant details:', restaurantId);
            showSuccess('Opening restaurant details...');
        }

        function contactRestaurant(restaurantId) {
            console.log('📞 Contacting restaurant:', restaurantId);
            showSuccess('Opening communication interface...');
        }

        async function removeRestaurant(restaurantId) {
            const restaurant = venueRestaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;

            if (!confirm(`Are you sure you want to remove ${restaurant.name} from your venue? This action cannot be undone.`)) {
                return;
            }

            const reason = prompt('Please provide a reason for removing this restaurant:') || 'Removed by venue manager';

            try {
                showLoading('Removing restaurant...', 'Updating venue association');

                await VenueSync.unsyncRestaurantFromVenue(restaurantId, reason);
                
                // Refresh data
                await loadAllVenueData();
                updateVenueManagement();
                
                hideLoading();
                showSuccess(`${restaurant.name} has been removed from the venue.`);
                
            } catch (error) {
                console.error('❌ Error removing restaurant:', error);
                hideLoading();
                showError('Failed to remove restaurant: ' + error.message);
            }
        }

        // Invitation management functions
        async function resendInvitation(inviteId) {
            console.log('📨 Resending invitation:', inviteId);
            showSuccess('Invitation resent (feature coming soon)');
        }

        async function cancelInvitation(inviteId) {
            if (!confirm('Are you sure you want to cancel this invitation?')) {
                return;
            }

            try {
                showLoading('Cancelling invitation...', 'Updating invitation status');

                await VenueSync.cancelInvitation(inviteId);
                
                // Refresh data
                await loadAllVenueData();
                updateVenueManagement();
                
                hideLoading();
                showSuccess('Invitation cancelled successfully');
                
            } catch (error) {
                console.error('❌ Error cancelling invitation:', error);
                hideLoading();
                showError('Failed to cancel invitation: ' + error.message);
            }
        }

        function renewInvitation(inviteId) {
            console.log('🔄 Renewing invitation:', inviteId);
            showSuccess('Invitation renewal (feature coming soon)');
        }

        function viewInvitationDetails(inviteId) {
            const invite = venueInvitations.find(inv => inv.id === inviteId);
            if (invite) {
                alert(`Invitation Details:\n\nRestaurant: ${invite.restaurantName}\nEmail: ${invite.contactEmail}\nStatus: ${invite.status}\nSent: ${VediAPI.timestampToDate(invite.createdAt).toLocaleDateString()}\n${invite.personalMessage ? `Message: "${invite.personalMessage}"` : ''}`);
            }
        }

        function viewRequestDetails(requestId) {
            const request = venueRequests.find(req => req.id === requestId);
            if (request) {
                alert(`Request Details:\n\nRestaurant: ${request.restaurantName}\nEmail: ${request.restaurantEmail}\nCuisine: ${request.restaurantCuisine}\nAddress: ${request.restaurantAddress}\nStatus: ${request.status}\nRequested: ${VediAPI.timestampToDate(request.requestedAt).toLocaleDateString()}\n${request.message ? `Message: "${request.message}"` : ''}`);
            }
        }

        function viewFullActivityLog() {
            console.log('📋 Viewing full activity log...');
            showSuccess('Opening comprehensive activity log...');
        }

        // Utility functions
        function getSyncMethodText(syncMethod) {
            switch(syncMethod) {
                case 'venue_invitation': return 'Invitation';
                case 'restaurant_request': return 'Request';
                case 'manual_sync': return 'Manual';
                default: return 'Unknown';
            }
        }

        function getSyncMethodClass(syncMethod) {
            switch(syncMethod) {
                case 'venue_invitation': return 'status-active';
                case 'restaurant_request': return 'status-pending';
                case 'manual_sync': return 'status-inactive';
                default: return 'status-inactive';
            }
        }

        function getActivityIcon(type) {
            const icons = {
                'invitation': '📨',
                'request': '📝',
                'restaurant': '🏪',
                'performance': '📊',
                'maintenance': '🔧',
                'settings': '⚙️',
                'venue': '🏢'
            };
            return icons[type] || '📋';
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 60) return `${diffMins} minutes ago`;
            if (diffHours < 24) return `${diffHours} hours ago`;
            return `${diffDays} days ago`;
        }

        function showLoading(message = 'Loading...') {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            text.textContent = message;
            overlay.style.display = 'flex';
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = 'none';
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 10000;
                background: ${type === 'success' ? 'linear-gradient(135deg, #48bb78, #38a169)' : 'linear-gradient(135deg, #ef4444, #dc2626)'};
                color: white; padding: 15px 25px; border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                font-weight: 600; opacity: 0; transition: all 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.opacity = '1', 100);
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        function showSuccess(message) {
            showNotification(message, 'success');
        }

        function showError(message) {
            showNotification(message, 'error');
        }

        // Helper function to get Firebase database (matches firebase-api.js pattern)
        function getFirebaseDb() {
            if (window.firebaseDb) {
                return window.firebaseDb;
            } else if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                window.firebaseDb = firebase.firestore();
                return window.firebaseDb;
            } else {
                throw new Error('Firebase database not initialized. Please ensure Firebase is loaded.');
            }
        }

        console.log('🏢 Enhanced Venue Management with VenueSync integration loaded successfully');
    </script>
</body>
</html>
